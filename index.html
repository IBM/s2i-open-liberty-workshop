
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="IBM Developer">
      
      
        <link rel="canonical" href="https://ibm.github.io/s2i-open-liberty-workshop/">
      
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.5">
    
    
      
        <title>Source-to-Image (S2I) Open Liberty Workshop</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.6a10b989.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,300i,400,400i,700,700i%7CIBM+Plex+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"IBM Plex Sans";--md-code-font:"IBM Plex Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#source-to-image-builder-for-open-liberty-applications-on-openshift" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="Source-to-Image (S2I) Open Liberty Workshop" class="md-header__button md-logo" aria-label="Source-to-Image (S2I) Open Liberty Workshop" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Source-to-Image (S2I) Open Liberty Workshop
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              S2I Workshop
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ibm/s2i-open-liberty-workshop" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    s2i-open-liberty-workshop
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Source-to-Image (S2I) Open Liberty Workshop" class="md-nav__button md-logo" aria-label="Source-to-Image (S2I) Open Liberty Workshop" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Source-to-Image (S2I) Open Liberty Workshop
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ibm/s2i-open-liberty-workshop" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    s2i-open-liberty-workshop
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    S2I Workshop
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    S2I Workshop
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#structure-of-this-repository" class="md-nav__link">
    Structure of this repository
  </a>
  
    <nav class="md-nav" aria-label="Structure of this repository">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    Setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-builder-image" class="md-nav__link">
    Build the builder image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-runtime-image" class="md-nav__link">
    Build the runtime image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-s2i-to-build-the-application-container" class="md-nav__link">
    Use S2I to build the application container
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment-to-openshift" class="md-nav__link">
    Deployment to OpenShift
  </a>
  
    <nav class="md-nav" aria-label="Deployment to OpenShift">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploying-as-a-traditional-kubernetes-deployment" class="md-nav__link">
    Deploying as a traditional Kubernetes deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automating-deployment-with-buildconfig-and-deploymentconfig" class="md-nav__link">
    Automating deployment with BuildConfig and DeploymentConfig
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-configure-a-github-webhook-for-automating-builds" class="md-nav__link">
    Optional: Configure a GitHub Webhook for automating builds
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#structure-of-this-repository" class="md-nav__link">
    Structure of this repository
  </a>
  
    <nav class="md-nav" aria-label="Structure of this repository">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    Setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-builder-image" class="md-nav__link">
    Build the builder image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-runtime-image" class="md-nav__link">
    Build the runtime image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-s2i-to-build-the-application-container" class="md-nav__link">
    Use S2I to build the application container
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment-to-openshift" class="md-nav__link">
    Deployment to OpenShift
  </a>
  
    <nav class="md-nav" aria-label="Deployment to OpenShift">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploying-as-a-traditional-kubernetes-deployment" class="md-nav__link">
    Deploying as a traditional Kubernetes deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automating-deployment-with-buildconfig-and-deploymentconfig" class="md-nav__link">
    Automating deployment with BuildConfig and DeploymentConfig
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-configure-a-github-webhook-for-automating-builds" class="md-nav__link">
    Optional: Configure a GitHub Webhook for automating builds
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="source-to-image-builder-for-open-liberty-applications-on-openshift">Source To Image Builder for Open Liberty Applications on OpenShift<a class="headerlink" href="#source-to-image-builder-for-open-liberty-applications-on-openshift" title="Permanent link">&para;</a></h1>
<p>This project contains a Source-to-Image (S2I) builder image and a S2I runtime image which creates an image running Java web applications on <a href="https://openliberty.io/">Open Liberty</a>.</p>
<p><a href="https://github.com/openshift/source-to-image">Source-to-Image</a> (S2I) is an open source toolkit for building reproducible container images from source code. S2I produces ready-to-run images by injecting source code into a container image.</p>
<p>The Open Liberty builder can be used in two different environments:</p>
<ul>
<li>Local Docker runtime via 's2i',</li>
<li>Deployment to OpenShift'.</li>
</ul>
<p>With interpreted languages like python and javascript, the runtime container is also the build container. For example, with a node.js application the 'npm install' is run to build the application and then 'npm start' is run in the same container in order to start the application.</p>
<p>However, with compiled languages like Java, the build and runtime processes can be separated. This will allow for slimmer runtime containers for faster application starts and less bloat in the application image.</p>
<p>This lab will focus on the second scenario of using a builder image along with a runtime image.</p>
<p><img alt="runtime image flow" src="images/runtime-image-flow.png" />
(source: <a href="https://github.com/openshift/source-to-image/blob/master/docs/runtime_image.md">https://github.com/openshift/source-to-image/blob/master/docs/runtime_image.md</a>)</p>
<h2 id="structure-of-this-repository">Structure of this repository<a class="headerlink" href="#structure-of-this-repository" title="Permanent link">&para;</a></h2>
<h3 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h3>
<p>The following prerequisites are needed:</p>
<ul>
<li><a href="https://www.docker.com/products/docker-desktop">Docker</a></li>
<li><a href="https://github.com/openshift/source-to-image/releases">Source to Image CLI</a></li>
<li><a href="https://hub.docker.com">A Docker Hub account</a></li>
<li><a href="https://docs.openshift.com/container-platform/4.3/cli_reference/openshift_cli/getting-started-cli.html">OpenShift CLI</a></li>
<li><a href="https://github.com/">GitHub Account</a></li>
<li><a href="https://git-scm.com/downloads">Git CLI</a></li>
</ul>
<h3 id="setup">Setup<a class="headerlink" href="#setup" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Clone this repository locally and navigate to the newly cloned directory.</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/IBM/s2i-open-liberty-workshop.git
<span class="nb">cd</span><span class="w"> </span>s2i-open-liberty-workshop
</code></pre></div>
</li>
<li>
<p>If you are running this lab in a browser based terminal environment like Skills Network and need to install the Source to Image CLI tool, follow this step:</p>
<ol>
<li>Run the setup script</li>
</ol>
<div class="highlight"><pre><span></span><code>chmod<span class="w"> </span>+x<span class="w"> </span>./setup.sh
./setup.sh
<span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$HOME</span>/s2i:<span class="nv">$PATH</span>
</code></pre></div>
</li>
<li>
<p>To make things easier, we are going to set some environment variables that we can reuse in later commands.</p>
<p><strong>Note</strong>: Replace <em>Your Username</em> with your actual docker hub username. If you do not have one, go <a href="https://hub.docker.com">here</a> to create one.</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">ROOT_FOLDER</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">DOCKER_USERNAME</span><span class="o">=</span>&lt;your-docker-username&gt;
</code></pre></div>
</li>
<li>
<p>Log in with your OpenShift Cluster.</p>
</li>
<li>
<p>Open your <code>OpenShift web console</code> and from the profile dropdown <code>Copy Login Command</code>.</p>
</li>
<li>
<p>Paste the login command to login, e.g.</p>
<div class="highlight"><pre><span></span><code>oc<span class="w"> </span>login<span class="w"> </span>--token<span class="o">=</span>&lt;login-token&gt;<span class="w"> </span>--server<span class="o">=</span>https://&lt;cluster-subdomain&gt;:&lt;service-port&gt;
</code></pre></div>
</li>
</ol>
<h3 id="build-the-builder-image">Build the builder image<a class="headerlink" href="#build-the-builder-image" title="Permanent link">&para;</a></h3>
<p>In this section we will create the first of our two S2I images. This image will be responsible for taking in our source code and building the application binary with Maven.</p>
<ol>
<li>
<p>Navigate to the builder image directory</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">ROOT_FOLDER</span><span class="si">}</span>/builder-image
</code></pre></div>
</li>
<li>
<p>Review the ./Dockerfile</p>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>Dockerfile
</code></pre></div>
<ul>
<li>
<p>The image uses a Redhat certified Universal Base Image (UBI) from the public container registry at Redhat,</p>
<div class="highlight"><pre><span></span><code>FROM<span class="w"> </span>registry.access.redhat.com/ubi8/ubi:8.1
</code></pre></div>
</li>
</ul>
</li>
<li>
<p>You can customize the builder image further, e.g. change the <code>LABEL</code> for <code>maintainer</code> to your name,</p>
<div class="highlight"><pre><span></span><code>LABEL<span class="w"> </span><span class="nv">maintainer</span><span class="o">=</span><span class="s2">&quot;&lt;your-name&gt;&quot;</span>
</code></pre></div>
</li>
<li>
<p>Now build the builder image.</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span><span class="nv">$DOCKER_USERNAME</span>/s2i-open-liberty-builder:0.1.0<span class="w"> </span>.
</code></pre></div>
</li>
<li>
<p>Push the builder image out to Docker hub.</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>login
docker<span class="w"> </span>push<span class="w"> </span><span class="nv">$DOCKER_USERNAME</span>/s2i-open-liberty-builder:0.1.0
</code></pre></div>
<p>With that done, you can now build your runtime image.</p>
</li>
</ol>
<h3 id="build-the-runtime-image">Build the runtime image<a class="headerlink" href="#build-the-runtime-image" title="Permanent link">&para;</a></h3>
<p>In this section you will create the second of our two S2I images. The runtime image will be responsible for taking the compiled binary from the builder image and serving it with the Open Liberty application server.</p>
<ol>
<li>
<p>Navigate to the runtime image directory</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span><span class="nv">$ROOT_FOLDER</span>/runtime-image
</code></pre></div>
</li>
<li>
<p>Review the ./Dockerfile</p>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>Dockerfile
</code></pre></div>
</li>
<li>
<p>Build the runtime image</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span><span class="nv">$DOCKER_USERNAME</span>/s2i-open-liberty:0.1.0<span class="w"> </span>.
</code></pre></div>
</li>
<li>
<p>Push the runtime image to Docker hub.</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>push<span class="w"> </span><span class="nv">$DOCKER_USERNAME</span>/s2i-open-liberty:0.1.0
</code></pre></div>
<p>Now we are ready to build our application with S2I.</p>
</li>
</ol>
<h3 id="use-s2i-to-build-the-application-container">Use S2I to build the application container<a class="headerlink" href="#use-s2i-to-build-the-application-container" title="Permanent link">&para;</a></h3>
<p>In this section, we will use S2I to build our application container image and then we will run the image locally using Docker.</p>
<ol>
<li>
<p>Use the builder image and runtime image to build the application image</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span><span class="nv">$ROOT_FOLDER</span>/web-app
</code></pre></div>
</li>
<li>
<p>Run a multistage S2I build, to build the application.</p>
<div class="highlight"><pre><span></span><code>s2i<span class="w"> </span>build<span class="w"> </span>.<span class="w"> </span><span class="nv">$DOCKER_USERNAME</span>/s2i-open-liberty-builder:0.1.0<span class="w"> </span>authors<span class="w"> </span>--runtime-image<span class="w"> </span><span class="nv">$DOCKER_USERNAME</span>/s2i-open-liberty:0.1.0<span class="w"> </span>-a<span class="w"> </span>/tmp/src/target<span class="w"> </span>-a<span class="w"> </span>/tmp/src/server.xml
</code></pre></div>
<p>Let's break down the above command:</p>
<ul>
<li><code>s2i build .</code>: Use <a href="https://github.com/openshift/source-to-image/blob/master/docs/cli.md#s2i-build"><code>s2i build</code></a> in the current directory to build the Docker image by combining the builder image and sources</li>
<li><code>$DOCKER_USERNAME/s2i-open-liberty-builder:0.1.0</code>: This is the builder image used to build the application</li>
<li><code>authors</code>: name of our application image</li>
<li><code>--runtime-image $DOCKER_USERNAME/s2i-open-liberty:0.1.0</code>: Take the output of the builder image and run it in this container.</li>
<li><code>-a /tmp/src/target -a /tmp/src/server.xml</code>: The <code>runtime-artifact</code> flag specifies a file or directory to be copies from builder to runtime image. The runtime-artifact is where the builder output is located. These files will be passed into the runtime image.</li>
</ul>
</li>
<li>
<p>Run the newly built image to start the application on your local machine in the background,</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--rm<span class="w"> </span>-p<span class="w"> </span><span class="m">9080</span>:9080<span class="w"> </span>authors
</code></pre></div>
</li>
<li>
<p>Retrieve the authors using curl,</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://localhost:9080/api/v1/getauthor&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;accept: application/json&quot;</span>
</code></pre></div>
</li>
<li>
<p>Or open up your browser and navigate to <a href="http://localhost:9080/openapi/ui">http://localhost:9080/openapi/ui</a> to view your deployed microservice.</p>
</li>
</ol>
<h3 id="deployment-to-openshift">Deployment to OpenShift<a class="headerlink" href="#deployment-to-openshift" title="Permanent link">&para;</a></h3>
<p>In the following labs we will be using two deployment strategies:</p>
<ul>
<li>manually deploy as a traditional Kubernetes <code>Deployment</code>, and</li>
<li>automatic build and deployment using OpenShift <code>BuildConfig</code> and <code>DeploymentConfig</code>.</li>
</ul>
<p>Both ways are very similar, the main difference being that with OpenShift BuildConfig and DeploymentConfig we can set triggers to automatically build the application when a new image tag has been pushed to the internal registry.</p>
<p>Now that we have the application running locally and have verified that it works, let's deploy it to an OpenShift environment.</p>
<ol>
<li>
<p>In order to deploy to OpenShift, we need to push our images to your cluster's internal registry. First, run the following commands to authenticate with your OpenShift image registry.</p>
<div class="highlight"><pre><span></span><code>oc<span class="w"> </span>patch<span class="w"> </span>configs.imageregistry.operator.openshift.io/cluster<span class="w"> </span>--patch<span class="w"> </span><span class="s1">&#39;{&quot;spec&quot;:{&quot;defaultRoute&quot;:true}}&#39;</span><span class="w"> </span>--type<span class="o">=</span>merge

<span class="nb">export</span><span class="w"> </span><span class="nv">REGISTRY</span><span class="o">=</span><span class="k">$(</span>oc<span class="w"> </span>get<span class="w"> </span>route<span class="w"> </span>default-route<span class="w"> </span>-n<span class="w"> </span>openshift-image-registry<span class="w"> </span>--template<span class="o">=</span><span class="s1">&#39;{{ .spec.host }}&#39;</span><span class="k">)</span>
<span class="nb">echo</span><span class="w"> </span><span class="nv">$REGISTRY</span>

docker<span class="w"> </span>login<span class="w"> </span>-u<span class="w"> </span><span class="k">$(</span>oc<span class="w"> </span>whoami<span class="k">)</span><span class="w"> </span>-p<span class="w"> </span><span class="k">$(</span>oc<span class="w"> </span>whoami<span class="w"> </span>-t<span class="k">)</span><span class="w"> </span><span class="nv">$REGISTRY</span>
</code></pre></div>
</li>
</ol>
<h4 id="deploying-as-a-traditional-kubernetes-deployment">Deploying as a traditional Kubernetes deployment<a class="headerlink" href="#deploying-as-a-traditional-kubernetes-deployment" title="Permanent link">&para;</a></h4>
<p>For this method, we will deploy our application by creating a kubernetes deployment along with a service and a route.</p>
<ol>
<li>
<p>Tag the image that was created in the previous section.</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">IMAGE</span><span class="o">=</span>docker.io/<span class="nv">$DOCKER_USERNAME</span>/authors:0.1.0
<span class="nb">echo</span><span class="w"> </span><span class="nv">$IMAGE</span>
docker<span class="w"> </span>tag<span class="w"> </span>authors<span class="w"> </span><span class="nv">$IMAGE</span>
</code></pre></div>
</li>
<li>
<p>Push the image that we built locally using s2i to the OpenShift image registry.</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>push<span class="w"> </span><span class="nv">$IMAGE</span>
</code></pre></div>
</li>
<li>
<p>Go back to the root folder,</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span><span class="nv">$ROOT_FOLDER</span>
</code></pre></div>
</li>
<li>
<p>Review the <code>application.yaml</code> file,</p>
<div class="highlight"><pre><span></span><code>sed<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;s|APPLICATION_IMAGE|</span><span class="nv">$IMAGE</span><span class="s2">|&quot;</span><span class="w"> </span>application.yaml
cat<span class="w"> </span>application.yaml
</code></pre></div>
</li>
<li>
<p>Apply the <code>application.yaml</code> file using the <code>oc</code> cli to create our Deployment, Service, and Route.</p>
<div class="highlight"><pre><span></span><code>oc<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>application.yaml
</code></pre></div>
</li>
<li>
<p>Now let's visit the deployed application. Run the following to get the route to access the application.</p>
<div class="highlight"><pre><span></span><code>oc<span class="w"> </span>get<span class="w"> </span>routes<span class="w"> </span>-l<span class="w"> </span><span class="nv">app</span><span class="o">=</span>authors<span class="w"> </span>-o<span class="w"> </span>go-template<span class="o">=</span><span class="s1">&#39;{{range .items}}{{.spec.host}}{{end}}&#39;</span>
</code></pre></div>
</li>
<li>
<p>Copy and paste the output of the previous command to set a variable $APP_URL,</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">APP_URL</span><span class="o">=</span>&lt;get-routes-output&gt;
</code></pre></div>
</li>
<li>
<p>Test the application using curl</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://</span><span class="nv">$APP_URL</span><span class="s2">/api/v1/getauthor&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;accept: application/json&quot;</span>
</code></pre></div>
</li>
<li>
<p>Or use the route to your app and paste it into your web browser and add the following to the end of the route:</p>
<div class="highlight"><pre><span></span><code>/openapi/ui
</code></pre></div>
<p>So your route should appear like the following but without the (...):</p>
<div class="highlight"><pre><span></span><code>authors-route-default...appdomain.cloud/openapi/ui
</code></pre></div>
<p>It sometimes takes a minute to fully deploy so if you get a message about the application not being available, try again.</p>
<p>You should now see the OpenAPI documentation for the getAuthor endpoint of your microservice.</p>
</li>
</ol>
<h4 id="automating-deployment-with-buildconfig-and-deploymentconfig">Automating deployment with BuildConfig and DeploymentConfig<a class="headerlink" href="#automating-deployment-with-buildconfig-and-deploymentconfig" title="Permanent link">&para;</a></h4>
<p>For this section, you will explore how to automate our application build and deploy using OpenShift concepts known as build config and deployment config. With build configs, the s2i builds are actually happening on the cluster rather than locally.</p>
<ol>
<li>
<p>Tag our builder and runtime images for OpenShift registry.</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>tag<span class="w"> </span><span class="nv">$DOCKER_USERNAME</span>/s2i-open-liberty-builder:0.1.0<span class="w"> </span><span class="nv">$REGISTRY</span>/default/s2i-open-liberty-builder:0.1.0

docker<span class="w"> </span>tag<span class="w"> </span><span class="nv">$DOCKER_USERNAME</span>/s2i-open-liberty:0.1.0<span class="w"> </span><span class="nv">$REGISTRY</span>/default/s2i-open-liberty:0.1.0
</code></pre></div>
</li>
<li>
<p>Push the images to the registry.</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>push<span class="w"> </span><span class="nv">$REGISTRY</span>/default/s2i-open-liberty-builder:0.1.0

docker<span class="w"> </span>push<span class="w"> </span><span class="nv">$REGISTRY</span>/default/s2i-open-liberty:0.1.0
</code></pre></div>
</li>
<li>
<p>We are almost ready to deploy our application but first we need to create an application template that contains all the components of our application. See <a href="https://docs.openshift.com/container-platform/4.3/openshift_images/using-templates.html">Using Templates</a>.</p>
</li>
<li>
<p>Review the <code>template.yaml</code> file, which contains the BuildConfig object and the DeploymentConfig object as well as the other application objects,</p>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>template.yaml
</code></pre></div>
</li>
<li>
<p>The template file that we will apply, creates the following Kubernetes objects:</p>
<ul>
<li>Template,</li>
<li>4 ImageStream objects: authors-builder, authors-runtime, s2i-open-liberty-builder, s2i-open-liberty</li>
<li>2 BuildConfig objects: the <code>open-liberty-builder</code> produces a <code>authors-builder:0.1.0</code> from <code>s2i-open-liberty-builder:0.1.0</code>; and the <code>open-liberty-app</code> produces an <code>authors-runtime:0.1.0</code> from <code>s2i-open-liberty:0.1.0</code>. The former build config is for the builder image and the latter is for the runtime image.</li>
<li>DeploymentConfig for <code>authors-runtime:0.1.0</code> to manage the application Pods and ReplicationController,</li>
<li>Service, and</li>
<li>Route.</li>
</ul>
<div class="highlight"><pre><span></span><code>oc<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>template.yaml
</code></pre></div>
</li>
<li>
<p>Lastly, we can use the <code>oc</code> cli to deploy the application while using the template that was just created.</p>
<div class="highlight"><pre><span></span><code>oc<span class="w"> </span>new-app<span class="w"> </span>--template<span class="w"> </span>open-liberty-app<span class="w"> </span>-p<span class="w"> </span><span class="nv">DOCKER_USERNAME</span><span class="o">=</span><span class="nv">$DOCKER_USERNAME</span>
</code></pre></div>
<p>After running the command you may see a message that says <code>Failed</code> however this is because the build has not yet completed.</p>
<div class="highlight"><pre><span></span><code>...
--&gt;<span class="w"> </span>Creating<span class="w"> </span>resources<span class="w"> </span>...
<span class="w">    </span>imagestream.image.openshift.io<span class="w"> </span><span class="s2">&quot;authors-builder&quot;</span><span class="w"> </span>created
<span class="w">    </span>imagestream.image.openshift.io<span class="w"> </span><span class="s2">&quot;authors-runtime&quot;</span><span class="w"> </span>created
<span class="w">    </span>error:<span class="w"> </span>imagestreams.image.openshift.io<span class="w"> </span><span class="s2">&quot;s2i-open-liberty-builder&quot;</span><span class="w"> </span>already<span class="w"> </span>exists
<span class="w">    </span>imagestream.image.openshift.io<span class="w"> </span><span class="s2">&quot;s2i-open-liberty&quot;</span><span class="w"> </span>created
<span class="w">    </span>buildconfig.build.openshift.io<span class="w"> </span><span class="s2">&quot;open-liberty-builder&quot;</span><span class="w"> </span>created
<span class="w">    </span>buildconfig.build.openshift.io<span class="w"> </span><span class="s2">&quot;open-liberty-app&quot;</span><span class="w"> </span>created
<span class="w">    </span>deploymentconfig.apps.openshift.io<span class="w"> </span><span class="s2">&quot;authors2&quot;</span><span class="w"> </span>created
<span class="w">    </span>service<span class="w"> </span><span class="s2">&quot;authors2&quot;</span><span class="w"> </span>created
<span class="w">    </span>route.route.openshift.io<span class="w"> </span><span class="s2">&quot;authors2&quot;</span><span class="w"> </span>created
--&gt;<span class="w"> </span>Failed
</code></pre></div>
</li>
<li>
<p>If you log into your OpenShift console and navigate to <code>Builds</code> &gt; <code>Builds</code> you should see your builds running.</p>
</li>
<li>
<p>Or list all builds,</p>
<div class="highlight"><pre><span></span><code>oc<span class="w"> </span>get<span class="w"> </span>builds
NAME<span class="w">                     </span>TYPE<span class="w">     </span>FROM<span class="w">          </span>STATUS<span class="w">     </span>STARTED<span class="w">          </span>DURATION
open-liberty-builder-1<span class="w">   </span>Source<span class="w">   </span>Git@7fe598c<span class="w">   </span>Complete<span class="w">   </span><span class="m">21</span><span class="w"> </span>minutes<span class="w"> </span>ago<span class="w">   </span>1m11s
</code></pre></div>
</li>
<li>
<p>Describe the build to review the status,</p>
<div class="highlight"><pre><span></span><code>oc<span class="w"> </span>get<span class="w"> </span>build<span class="w"> </span>open-liberty-builder-1
NAME<span class="w">                     </span>TYPE<span class="w">     </span>FROM<span class="w">          </span>STATUS<span class="w">     </span>STARTED<span class="w">          </span>DURATION
open-liberty-builder-1<span class="w">   </span>Source<span class="w">   </span>Git@7fe598c<span class="w">   </span>Complete<span class="w">   </span><span class="m">23</span><span class="w"> </span>minutes<span class="w"> </span>ago<span class="w">   </span>1m11s
</code></pre></div>
</li>
<li>
<p>Once those builds complete a replication controller will be created that manages the application pods. Navigate to <code>Workloads</code> &gt; <code>Pods</code> and look for your new pod. It should start with <code>authors-</code>.</p>
<div class="highlight"><pre><span></span><code>oc<span class="w"> </span>get<span class="w"> </span>pods
NAME<span class="w">                                  </span>READY<span class="w">   </span>STATUS<span class="w">      </span>RESTARTS<span class="w">   </span>AGE
authors-deployment-5df596c88f-7vcgb<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>56m
open-liberty-builder-1-build<span class="w">          </span><span class="m">0</span>/1<span class="w">     </span>Completed<span class="w">   </span><span class="m">0</span><span class="w">          </span>25m
</code></pre></div>
</li>
<li>
<p>Once you have verified that the new pod is running, enter the following command to view the application routes.</p>
<div class="highlight"><pre><span></span><code>oc<span class="w"> </span>get<span class="w"> </span>routes

NAME<span class="w">    </span>HOST/PORT<span class="w">    </span>PATH<span class="w">    </span>SERVICES<span class="w">    </span>PORT<span class="w">    </span>TERMINATION<span class="w">    </span>WILDCARD
authors-route<span class="w">    </span>authors-route-default.your-roks-43-1n-cl-2bef1f4b4097001da9502000c44fc2b2-0000.us-south.containers.appdomain.cloud<span class="w">    </span>authors-service<span class="w">    </span>http<span class="w">    </span>None
authors2<span class="w">    </span>authors2-default.your-roks-43-1n-cl-2bef1f4b4097001da9502000c44fc2b2-0000.us-south.containers.appdomain.cloud<span class="w">    </span>authors2<span class="w">    </span><span class="m">9080</span><span class="w">    </span>None
</code></pre></div>
</li>
<li>
<p>Use the route named <code>authors2</code> and append <code>/openapi/ui</code> after the <code>HOST/PORT</code> value to open the UI, or append <code>/api/v1/getauthor</code> to set the API_URL. View the sample below, however, you will have a different route.</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">API_URL</span><span class="o">=</span>authors2-default.osgdcw01-0e3e0ef4c9c6d831e8aa6fe01f33bfc4-0000.sjc04.containers.appdomain.cloud
</code></pre></div>
<p>Then test your application with the command below:</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://</span><span class="nv">$API_URL</span><span class="s2">/api/v1/getauthor&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;accept: application/json&quot;</span>
</code></pre></div>
</li>
</ol>
<h3 id="optional-configure-a-github-webhook-for-automating-builds">Optional: Configure a GitHub Webhook for automating builds<a class="headerlink" href="#optional-configure-a-github-webhook-for-automating-builds" title="Permanent link">&para;</a></h3>
<p>In this optional section we will explore the option of configuring a webhook that will automatically notify OpenShift of a git push and will kick off the build and deploy process.</p>
<ol>
<li>
<p>First we need to create your own version of the code repo by creating a fork. This will copy the repo into your GitHub account. Navigate to the lab repo at <a href="https://github.com/IBM/s2i-open-liberty-workshop">https://github.com/IBM/s2i-open-liberty-workshop</a> and click on the <strong>Fork</strong> button in the upper right of the page.</p>
</li>
<li>
<p>When the repo is done forking, click on the green <strong>Clone or download</strong> button and copy your git repo url.</p>
</li>
<li>
<p>Then, in your terminal, navigate to a directory where you'd like to clone your repo locally and run the following commands while substituting <strong><repo_url></strong> with the url you copied in the previous step:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/home/project
mkdir<span class="w"> </span>clone
<span class="nb">cd</span><span class="w"> </span>clone
git<span class="w"> </span>clone<span class="w"> </span>&lt;repo_url&gt;
<span class="nb">cd</span><span class="w"> </span>s2i-open-liberty-workshop/
</code></pre></div>
</li>
<li>
<p>First let's delete the application that we deployed earlier. Run the following script:</p>
<div class="highlight"><pre><span></span><code>./delete.sh
</code></pre></div>
</li>
<li>
<p>Then run the following command to redeploy the application, this time we will specify to point to your newly created repo. Replace <strong>\&lt;repo url&gt;</strong> with the url to the GitHub repo that you copied earlier.</p>
<div class="highlight"><pre><span></span><code>oc<span class="w"> </span>new-app<span class="w"> </span>--template<span class="w"> </span>open-liberty-app<span class="w"> </span>-p<span class="w"> </span><span class="nv">SOURCE_REPOSITORY_URL</span><span class="o">=</span>&lt;repo<span class="w"> </span>url&gt;<span class="w"> </span>-p<span class="w"> </span><span class="nv">APP_NAME</span><span class="o">=</span>authors-3<span class="w"> </span>-p<span class="w"> </span><span class="nv">DOCKER_USERNAME</span><span class="o">=</span><span class="nv">$DOCKER_USERNAME</span>
</code></pre></div>
</li>
<li>
<p>Now you should see some output of the components that have been created as well as a section labled <strong>With parameters:</strong></p>
<div class="highlight"><pre><span></span><code><span class="w">    </span>*<span class="w"> </span>With<span class="w"> </span>parameters:
<span class="w">        </span>*<span class="w"> </span>Source<span class="w"> </span><span class="nv">URL</span><span class="o">=</span>https://github.com/odrodrig/s2i-open-liberty.git
<span class="w">        </span>*<span class="w"> </span>App<span class="w"> </span><span class="nv">name</span><span class="o">=</span>authors-3
<span class="w">        </span>*<span class="w"> </span>Source<span class="w"> </span><span class="nv">Branch</span><span class="o">=</span>master
<span class="w">        </span>*<span class="w"> </span>Source<span class="w"> </span><span class="nv">Directory</span><span class="o">=</span>/web-app
<span class="w">        </span>*<span class="w"> </span>Output<span class="w"> </span><span class="nv">Directory</span><span class="o">=</span>/tmp/src/
<span class="w">        </span>*<span class="w"> </span>GitHub<span class="w"> </span>Webhook<span class="w"> </span><span class="nv">Secret</span><span class="o">=</span>xxxxxxxx<span class="w"> </span><span class="c1"># generated</span>
</code></pre></div>
</li>
<li>
<p>Copy the GitHub Webhook Secret into a text document and save it for later.</p>
</li>
<li>
<p>In your terminal run the following command to get the webhook endpoint:</p>
<div class="highlight"><pre><span></span><code>oc<span class="w"> </span>describe<span class="w"> </span>bc<span class="w"> </span>open-liberty-builder
</code></pre></div>
<p>Look for the section labeled <strong>Webhook GitHub</strong>. It should look like the example below.</p>
<div class="highlight"><pre><span></span><code>Webhook<span class="w"> </span>GitHub:
<span class="w">    </span>URL:<span class="w"> </span>https://c107-e.us-south.containers.cloud.ibm.com:31689/apis/build.openshift.io/v1/namespaces/default/buildconfigs/open-liberty-builder/webhooks/&lt;secret&gt;/github
</code></pre></div>
<p>Replace the <strong>\&lt;secret&gt;</strong> portion from the url copied in the previous step with the secret you copied earlier.</p>
</li>
<li>
<p>Then, in your browser, navigate to your git repo and find the <strong>Settings</strong> tab.</p>
</li>
<li>
<p>From the project settings select <strong>Webhooks</strong> on the left side of the page and click on <em>new webhook</em>.</p>
</li>
<li>
<p>In the <em>payload url</em> field, enter the webhook url that you copied earlier with the included secret.</p>
</li>
<li>
<p>For the <em>content type</em>, select <em>application/json</em></p>
</li>
<li>
<p>Then, click <strong>Add webhook</strong></p>
<p>You should now see a webhook listed in the project settings. Ensure that the webhook has a green checkmark next to it. If there is a red X, try creating the webhook again.</p>
</li>
<li>
<p>Now that the webhook is configured, let's push a change and test it out. From your code editor of choice, navigate to the repo that you cloned and open <code>web-app/src/main/java/com/ibm/authors/GetAuthor.java</code></p>
</li>
<li>
<p>On lines 56-59 edit the name, twitter, and blog to your own information or fake information if you'd like.</p>
<div class="highlight"><pre><span></span><code><span class="n">Author</span><span class="w"> </span><span class="n">author</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Author</span><span class="p">();</span>
<span class="w">    </span><span class="n">author</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Oliver Rodriguez&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">author</span><span class="p">.</span><span class="na">twitter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;https://twitter.com/heres__ollie&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">author</span><span class="p">.</span><span class="na">blog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://developer.ibm.com&quot;</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>Save the file.</p>
</li>
<li>
<p>From your terminal and within your cloned repo run the following commands after replacing the email address and name with your own information. This is the email address used to sign into github.</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>config<span class="w"> </span>--global<span class="w"> </span>user.email<span class="w"> </span><span class="s2">&quot;you@example.com&quot;</span>
git<span class="w"> </span>config<span class="w"> </span>--global<span class="w"> </span>user.name<span class="w"> </span><span class="s2">&quot;Your Name&quot;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>add<span class="w"> </span>.
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Changed author info&quot;</span>
git<span class="w"> </span>push
</code></pre></div>
<p>With the changes pushed, we can now go to the OpenShift dashboard and view the builds that have been kicked by the GitHub webhook.</p>
</li>
<li>
<p>In your browser, go back into your OpenShift console and navigate to <code>Builds</code> &gt; <code>Builds</code> and you should see your builds running.</p>
</li>
<li>
<p>After the builds are completed, navigate to <code>Workloads</code> &gt; <code>Pods</code> and look for your new pod. It should start with <code>authors-3</code>.</p>
</li>
<li>
<p>Once you have verified that the new pod is running, enter the following command to view the application routes.</p>
<div class="highlight"><pre><span></span><code>oc<span class="w"> </span>get<span class="w"> </span>routes

NAME<span class="w">    </span>HOST/PORT<span class="w">    </span>PATH<span class="w">    </span>SERVICES<span class="w">    </span>PORT<span class="w">    </span>TERMINATION<span class="w">    </span>WILDCARD
authors-route<span class="w">    </span>authors-route-default.your-roks-43-1n-cl-2bef1f4b4097001da9502000c44fc2b2-0000.us-south.containers.appdomain.cloud<span class="w">    </span>authors-service<span class="w">    </span>http<span class="w">    </span>None
authors2<span class="w">    </span>authors2-default.your-roks-43-1n-cl-2bef1f4b4097001da9502000c44fc2b2-0000.us-south.containers.appdomain.cloud<span class="w">    </span>authors2<span class="w">    </span><span class="m">9080</span><span class="w">    </span>None
</code></pre></div>
</li>
<li>
<p>Use the route named <code>authors-3</code> and append <code>/openapi/ui</code> after the <code>HOST/PORT</code> value to open the UI, or append <code>/api/v1/getauthor</code> to set the API_URL. View the sample below, however, you will have a different route.</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">API_URL</span><span class="o">=</span>authors-3-default.osgdcw01-0e3e0ef4c9c6d831e8aa6fe01f33bfc4-0000.sjc04.containers.appdomain.cloud
</code></pre></div>
<p>Then test your application with the command below:</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://</span><span class="nv">$API_URL</span><span class="s2">/api/v1/getauthor&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;accept: application/json&quot;</span>
</code></pre></div>
</li>
</ol>
<p>You should then see the info that you edited in the file earlier.</p>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">&para;</a></h2>
<p>In this lab we have explored building our own custom s2i images for building containerized application from source code. We utilized a multi stage s2i process that separated the build environment from the runtime environment which allowed for us to have a slimmer application image. Then, we deployed the application as a traditional Kubernetes deployment. Lastly, we explored how to automate the building and deploying of the application using OpenShift build and deployment configs.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2020 IBM Developer
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/ibm" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/ibmdeveloper" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/company/ibm/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.youtube.com/user/developerworks" target="_blank" rel="noopener" title="www.youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://dev.to/ibmdeveloper" target="_blank" rel="noopener" title="dev.to" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M120.12 208.29c-3.88-2.9-7.77-4.35-11.65-4.35H91.03v104.47h17.45c3.88 0 7.77-1.45 11.65-4.35 3.88-2.9 5.82-7.25 5.82-13.06v-69.65c-.01-5.8-1.96-10.16-5.83-13.06zM404.1 32H43.9C19.7 32 .06 51.59 0 75.8v360.4C.06 460.41 19.7 480 43.9 480h360.2c24.21 0 43.84-19.59 43.9-43.8V75.8c-.06-24.21-19.7-43.8-43.9-43.8zM154.2 291.19c0 18.81-11.61 47.31-48.36 47.25h-46.4V172.98h47.38c35.44 0 47.36 28.46 47.37 47.28l.01 70.93zm100.68-88.66H201.6v38.42h32.57v29.57H201.6v38.41h53.29v29.57h-62.18c-11.16.29-20.44-8.53-20.72-19.69V193.7c-.27-11.15 8.56-20.41 19.71-20.69h63.19l-.01 29.52zm103.64 115.29c-13.2 30.75-36.85 24.63-47.44 0l-38.53-144.8h32.57l29.71 113.72 29.57-113.72h32.58l-38.46 144.8z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": ".", "features": ["navigation.instant"], "search": "assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.aecac24b.min.js"></script>
      
    
  </body>
</html>